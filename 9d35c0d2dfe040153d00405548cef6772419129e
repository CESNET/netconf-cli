{
  "comments": [
    {
      "key": {
        "uuid": "76cd0522_93ae4b1b",
        "filename": "/COMMIT_MSG",
        "patchSetId": 27
      },
      "lineNbr": 16,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2020-11-02T20:36:22Z",
      "side": 1,
      "message": "This might be understood that you\u0027re \"forking OpenSSH the project\" with some non-upstreamed patches, which is not the case -- you\u0027re forking a background process which is OpenSSH\u0027s `ssh`. No need to bother changing now, though.",
      "range": {
        "startLine": 16,
        "startChar": 40,
        "endLine": 16,
        "endChar": 49
      },
      "revId": "9d35c0d2dfe040153d00405548cef6772419129e",
      "serverId": "e32f8df8-3db0-4f76-a6c6-fe9d6e69dd68",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7b1cc7fb_d50ff2ab",
        "filename": "CMakeLists.txt",
        "patchSetId": 27
      },
      "lineNbr": 382,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2020-11-02T20:36:22Z",
      "side": 1,
      "message": "`netconf-cli` should be installed as well (please rebase this on top of https://gerrit.cesnet.cz/c/CzechLight/netconf-cli/+/3188)",
      "revId": "9d35c0d2dfe040153d00405548cef6772419129e",
      "serverId": "e32f8df8-3db0-4f76-a6c6-fe9d6e69dd68",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "76645b99_b9356ee3",
        "filename": "CMakeLists.txt",
        "patchSetId": 27
      },
      "lineNbr": 382,
      "author": {
        "id": 1000056
      },
      "writtenOn": "2020-11-03T01:02:34Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "7b1cc7fb_d50ff2ab",
      "revId": "9d35c0d2dfe040153d00405548cef6772419129e",
      "serverId": "e32f8df8-3db0-4f76-a6c6-fe9d6e69dd68",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "250b13ad_80baae41",
        "filename": "src/cli-netconf.cpp",
        "patchSetId": 27
      },
      "lineNbr": 41,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2020-11-02T20:36:22Z",
      "side": 1,
      "message": "Well, this will need some tests (sorry), because the hostname parsing is broken:\n\n $ ./netconf-cli root@line-nfp\n ssh: Could not resolve hostname line: Name or service not known",
      "revId": "9d35c0d2dfe040153d00405548cef6772419129e",
      "serverId": "e32f8df8-3db0-4f76-a6c6-fe9d6e69dd68",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f3c72f8b_65349e0b",
        "filename": "src/cli-netconf.cpp",
        "patchSetId": 27
      },
      "lineNbr": 41,
      "author": {
        "id": 1000056
      },
      "writtenOn": "2020-11-03T01:02:34Z",
      "side": 1,
      "message": "Or I might just get rid of that altogether. Or maybe I could just split by colon and use the left part for hostname and right part for port?",
      "parentUuid": "250b13ad_80baae41",
      "revId": "9d35c0d2dfe040153d00405548cef6772419129e",
      "serverId": "e32f8df8-3db0-4f76-a6c6-fe9d6e69dd68",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b59643f3_4c747b82",
        "filename": "src/cli-netconf.cpp",
        "patchSetId": 27
      },
      "lineNbr": 41,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2020-11-03T11:54:07Z",
      "side": 1,
      "message": "Either way, please write these tests (and be creative in trying to break the code). \"root@line-nfp\" still doesn\u0027t work.",
      "parentUuid": "f3c72f8b_65349e0b",
      "revId": "9d35c0d2dfe040153d00405548cef6772419129e",
      "serverId": "e32f8df8-3db0-4f76-a6c6-fe9d6e69dd68",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0cd126c7_25ef6fad",
        "filename": "src/cli-netconf.cpp",
        "patchSetId": 27
      },
      "lineNbr": 59,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2020-11-02T20:36:22Z",
      "side": 1,
      "message": "Error handling should be improved. When there\u0027s no `ssh` in $PATH (yeah, NixOS\u0027s `nix-shell --pure` :) ), this is the error message:\n \n$ ./netconf-cli wtfwtfwtf\nterminate called after throwing an instance of \u0027boost::process::process_error\u0027\n  what():  execve failed: No such file or directory\nAborted (core dumped)\n\nThis should, IMHO, print out an error message clearly saying that this is because the `ssh` program cannot be found.\n\nWhen the process forks, but it fails, here\u0027s what the user sees:\n \n$ ./netconf-cli wtfwtfwtf    \nssh: Could not resolve hostname wtfwtfwtf: Name or service not known\n[ERR]: Session 0: communication channel unexpectedly closed.\nSSH connection failed: nc_connect_inout failed\n\nIt would be nicer to just exit right after the error reported by SSH.",
      "revId": "9d35c0d2dfe040153d00405548cef6772419129e",
      "serverId": "e32f8df8-3db0-4f76-a6c6-fe9d6e69dd68",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "597e0235_50d70d29",
        "filename": "src/cli-netconf.cpp",
        "patchSetId": 27
      },
      "lineNbr": 59,
      "author": {
        "id": 1000056
      },
      "writtenOn": "2020-11-03T01:02:34Z",
      "side": 1,
      "message": "I don\u0027t know how to do this, I might go ask somewhere",
      "parentUuid": "0cd126c7_25ef6fad",
      "revId": "9d35c0d2dfe040153d00405548cef6772419129e",
      "serverId": "e32f8df8-3db0-4f76-a6c6-fe9d6e69dd68",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8871020e_3cfcda90",
        "filename": "src/cli-netconf.cpp",
        "patchSetId": 27
      },
      "lineNbr": 59,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2020-11-03T11:54:07Z",
      "side": 1,
      "message": "The first part got fixed, the second one is hard to mask as you said during the call (the process \"started\", and then it probably crashed) -\u003e OK.",
      "parentUuid": "597e0235_50d70d29",
      "revId": "9d35c0d2dfe040153d00405548cef6772419129e",
      "serverId": "e32f8df8-3db0-4f76-a6c6-fe9d6e69dd68",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "c545e832_7ebd0fc8",
        "filename": "src/cli-netconf.cpp",
        "patchSetId": 27
      },
      "lineNbr": 65,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2020-11-02T20:36:22Z",
      "side": 1,
      "message": "Don\u0027t do this -- this constructor (eventually) calls system(3), which uses a shell, which means that it\u0027s open to shell injection. I know that this patch uses Spirit to parse usernames, and (I hope) you disallow \"|\" and \"\u003e\" in there (etc), and one could possibly argue that this is a trusted input because it\u0027s provided by the user, but just don\u0027t do that. Use that overload which accepts a list/vector/sequence/whatever of arguments, and use that for starting a process.\n\nYou do *not* need a shell, and you should not subject yourself to a whole can of possible attacks here.",
      "revId": "9d35c0d2dfe040153d00405548cef6772419129e",
      "serverId": "e32f8df8-3db0-4f76-a6c6-fe9d6e69dd68",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "87cd1386_b5a3b3bf",
        "filename": "src/cli-netconf.cpp",
        "patchSetId": 27
      },
      "lineNbr": 65,
      "author": {
        "id": 1000056
      },
      "writtenOn": "2020-11-03T01:02:34Z",
      "side": 1,
      "message": "I tried strace and it just does execve to ssh, no shell:\n\n $ strace --follow --trace\u003d%process  ./netconf-cli localhost:9999\n execve(\"./netconf-cli\", [\"./netconf-cli\", \"localhost:9999\"], 0x7fffbfba83d8 /* 79 \n vars */) \u003d 0\n clone(child_stack\u003dNULL, flags\u003dCLONE_CHILD_CLEARTID|CLONE_CHILD_SETTID|SIGCHLD, \n child_tidptr\u003d0x7fce201e2a50) \u003d 86714\n strace: Process 86714 attached\n [pid 86714] execve(\"/home/vk/bin/ssh\", [\"ssh\", \"localhost\", \"-p\", \"9999\", \"-s\", \n \"netconf\"], 0x7ffd00fae120 /* 79 vars */) \u003d 0\n\nI\u0027m not sure how it knows where to find `ssh`, so maybe it does use the shell for that? Idk.\nI\u0027ll use the overload anyway, becaue I like it more (it didn\u0027t work for me before for some reason)",
      "parentUuid": "c545e832_7ebd0fc8",
      "revId": "9d35c0d2dfe040153d00405548cef6772419129e",
      "serverId": "e32f8df8-3db0-4f76-a6c6-fe9d6e69dd68",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1781584d_b3ef34e0",
        "filename": "src/cli-netconf.cpp",
        "patchSetId": 27
      },
      "lineNbr": 65,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2020-11-03T11:54:07Z",
      "side": 1,
      "message": "FYI, I had to run `set follow-fork-mode child` in GDB. After that, `catch syscall execve` worked as expected.\n\nAnyway, it looks good now.",
      "parentUuid": "87cd1386_b5a3b3bf",
      "revId": "9d35c0d2dfe040153d00405548cef6772419129e",
      "serverId": "e32f8df8-3db0-4f76-a6c6-fe9d6e69dd68",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "767cb119_bf648468",
        "filename": "src/cli.cpp",
        "patchSetId": 27
      },
      "lineNbr": 142,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2020-11-02T21:24:05Z",
      "side": 1,
      "message": "I don\u0027t think this is providing any useful information when an error happens. With `-v`:\n\n \n$ netconf-cli -v root@10.0.254.235\n...\n/\u003e get\nlibyang[1]: Invalid position of the key \"ifName\" in a list \"if-name\".\nlibyang[0]: Too many instances of \"ifName\" in \"if-name\". (path: /czechlight-lldp:nbr-list/if-name[ifName\u003d\u0027eth0\u0027]/ifName)\n[ERR]: Failed to parse \u003cget\u003e reply.\nFailed to receive an RPC reply\n\nWithout `-v`:\n \n$ netconf-cli root@10.0.254.235\n...\n/\u003e get\nlibyang[1]: Invalid position of the key \"ifName\" in a list \"if-name\".\nlibyang[0]: Too many instances of \"ifName\" in \"if-name\". (path: /czechlight-lldp:nbr-list/if-name[ifName\u003d\u0027eth0\u0027]/ifName)\n[ERR]: Failed to parse \u003cget\u003e reply.\nFailed to receive an RPC reply\n\nAm I doing something wrong? Is the log handler being set?",
      "revId": "9d35c0d2dfe040153d00405548cef6772419129e",
      "serverId": "e32f8df8-3db0-4f76-a6c6-fe9d6e69dd68",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4b1bece9_7833f75d",
        "filename": "src/cli.cpp",
        "patchSetId": 27
      },
      "lineNbr": 142,
      "author": {
        "id": 1000056
      },
      "writtenOn": "2020-11-03T01:02:34Z",
      "side": 1,
      "message": "The verbosity was getting reset in netconf-client.cpp",
      "parentUuid": "767cb119_bf648468",
      "revId": "9d35c0d2dfe040153d00405548cef6772419129e",
      "serverId": "e32f8df8-3db0-4f76-a6c6-fe9d6e69dd68",
      "unresolved": false
    }
  ]
}